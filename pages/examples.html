---
layout: default
title: Examples
description: Examples on how to use the FECGSYN
author: Fernando Andreotti
priority: 2
published: true
---



In this section exemplary use of the <em>FECGSYN</em> are illustrated. For more information make sure you consult the <a href="{{site.github.url}}/pages/documentation.html"><span class="octicon octicon-globe"></span> Documentation</a>.

<section class="bs-docs-section">
 
<h1 id="datagen" class="page-header">Data Generation</h1>
<!-- datagen 1 -->
  <h2 id="datagen1">Initial example</h2>

  <p> An exemplary dataset can be simply generated and plotted by running the following lines:</p>
  
{% highlight matlab %}
param.fs = 1000; % data generation at 1kHz
param.n = 15*param.fs;
param.SNRfm = -3; % fetal maternal SNR
param.SNRmn = 8; % maternal to noise SNR
param.ntype = {'MA'}; % adding muscular artifact type noise
param.noise_fct = {1}; % noise at constant SNR level
debug = 5; % debug level (5 = max number of plots generated)
out = run_ecg_generator(param,debug);
FECGSYN_plotmix(out) % plots random channels of one of the created datasets
{% endhighlight %}
  
<p>Please consider that various parameters (e.g. location of fetal heart, location of noise sources) are not explicitely defined in the previous example. Therefore, to reproduce physiological conditions, running the code twice will produce considerably different signals. In the following examples, more complex simulations are performed, where further parameters are controlled.</p>
  
<!-- datagen 2 -->
  <h2 id="datagen2">Ellaborate Example</h2>

  <p>This example make use of the <code>exp_datagen1.m</code> function to generate the dataset used in Behar et al 2014.      </p>

{% highlight matlab %}
cd 'directory_to_save'
path = pwd;
exp_datagen1(path,5,false) % generate dataset (may take a few minutes)
load('fecgsyn_c1.mat')
FECGSYN_plotmix(out) % plots random channels of one of the created datasets
{% endhighlight %}

 <h2 id="datagen3">Further examples</h2>
  
  <p>Similarly to the <code>exp_datagen1.m</code> example, the <em>FECGSYN</em> includes three further pre-built routines to data generation. For performance purpose, these functions DO NOT include wfdb support. Nevertheless, this can be simply expanded by using the <code>fecgsyn2wfdb.m</code> function (see this example). Below is a list of further examples included and a short description. For mor information, see  : </p>
  <ul>
    <li><code>FECGSYNDB_datagen.m</code>: This function generates a dateset similar to the one used in Andreotti et al 2016. <br>
      <div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> Since some parameters generated by the FECGSYN are randomly selected, the database will NOT be identical. For comparison purposes, make sure to download Physionets FECGSYNDB ( <a href="https://www.physionet.org/physiotools/ipmcode/fecgsyn/"><span class="octicon octicon-globe"></span> available here</a>).</p> </li>
    <li><code>exp_datagen2.m</code>: This example performs some additional maternal ECG amplitude changes (after generation) and SNR modulation (during generation). It is useful to stress testing the ability of Template Subtraction techniques in adapting their average template to an ECG with varying amplitude. More information is available in the <a href="{{site.github.url}}/pages/documentation.html#exp_datagen2"><span class="octicon octicon-globe"></span> Documentation</a>. </li>
    <li><code>exp_datagen3.m</code>: This example include highly oscilatting (e.g sinusoidal) changes in the noise SNR level and ECG amplitude changes. The aim of the dataset generate is to train algorithms that detect variations in the  MECG/FECG signal quality, i.e. signal quality indexes (SQIs).  More information is available in the <a href="{{site.github.url}}/pages/documentation.html#exp_datagen3"><span class="octicon octicon-globe"></span> Documentation</a>.</li>
  </ul>


</section>


<!-- -----------WFDB FECGSYN------- -->
<section class="bs-docs-section">
  <h1 id="wfdb" class="page-header">Convert to/from WFDB </h1>
  <p> WFDB is an open-source and widely used data format from Physionet (<a href="https://www.physionet.org"> www.physionet.org</a>). It is also the format adopted by the FECGSYNDB (<a href="https://www.physionet.org/physiotools/ipmcode/fecgsyn/"><span class="octicon octicon-globe"></span> available here</a>).</p>
  
  <p>The following subsections aim at demonstrating how to convert from <em>FECGSYN</em> Matlab/Octave format to WFDB format, and vice-versa. In order to use these functions, the WFDB App should be installed, as described in  <a href="{{site.github.url}}/pages/install.html"><span class="octicon octicon-globe"></span> Installing the <em>FECGSYN</em></a>.</p>
    
    
<h2 id="fecgsyn2wfdb">Converting FECGSYN to WFDB</h2>

  <p> This is done using the <code>fecgsyn2wfd.m</code> function. The function can be used to convert multiple <code>.mat</code> saved files using <em>FECGSYN</em> internal structure, such as:</p>
  
{% highlight matlab %}
  fecgsyn2mat('/path_to_mats/')  
{% endhighlight %}
  
  Alternatively, a single file can be converted (e.g. during generation) by using the following input arguments:
  
  {% highlight matlab %}
  % outstruct = structure containing dataset (intern from FECGSYN)
  % recName = string containing name which will be used to save WFDB dataset
  % dest_path = string containing destination folder for WFDB dataset
  fecgsyn2mat(dest_path,outstruct,recName) 
{% endhighlight %} 
 
  <div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> Make sure to compress and convert the <code>outstruct</code> before exporting it to WFDB format. This can be done using the <code>clean_compress.m</code> function, see the <a href="{{site.github.url}}/pages/documentation.html#clean_compress"><span class="octicon octicon-globe"></span> Documentation</a>. </div></div>
  
  <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> You may have a look at function <code>exp_datagen1.m</code> function for a simple use of the <code>fecgsyn2wfdb.m</code>, see <a href="{{site.github.url}}/pages/examples.html#datagen2">this example</a>. </div></div>

  
  <h2 id="wfdb2fecgsyn">Converting WFDB to FECGSYN</h2>

  Similarly, the <code>wfdb2fecgsyn.m</code> function is able to convert WFDB datasets into the <code>.mat</code> internal structure used by <em>FECGSYN</em>  <code>main_extract_data</code> script, such as:

{% highlight matlab %}
% path = string containing origin folder for WFDB dataset
wfdb2fecgsyn(path)
{% endhighlight %}

<div class="panel panel-warning"><div class="panel-heading"><span class="octicon octicon-alert"></span> Warning</div><div class="panel-body"> <code>path</code> must be an unique identifier for a WFDB dataset, which excludes the extension of the files. For instance, for the <em>FECGSYNDB</em> <code>'sub01_snr00dB_l1_c0'</code> represents an unique identifier for a dataset consisting of multiple files: <code>_mecg</code>,<code>_fecg1</code>,<code>_noise1</code> with <code>.dat</code>, <code>.hea</code>, <code>.mqrs</code> and <code>.fqrs</code> extensions.</div></div>

 <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> You may have a look at function <code>main_extract_data.m</code> function for a simple use of the <code>wfdb2fecgsyn.m</code>, see <a href="{{site.github.url}}/pages/examples.html#main_extract_data">this example</a>. </div></div>
</section>

<!-- -----------FECG EXTRACTION------- -->
<section class="bs-docs-section">
<h1 id="datext" class="page-header">FECG Extraction</h1>

<h2 id="tsc">Extraction using Template Subtraction</h2>

This example makes use of the template subtraction (TS) method by Cerutti et al 1986, using the <code>FECGSYN_ts_extraction.m</code> function. As input the function expects the maternal QRS locations (<code>mref</code>), abdominal signal (<code>mixture</code> - rows represent different channels), a predetermined number of cycles to use on the average maternal template (<code>NbCycles</code>) and sampling frequency used (<code>fs</code>). See the example:

{% highlight matlab %}
NbCycles = 20; % number of cycles used
residual = zeros(size(mixture));
for j = 1:length(ch)
  residual(j,:) = FECGSYN_ts_extraction(mref,mixture(j,:),'TS-CERUTTI',0,...
  NbCycles,'',fs);
end
{% endhighlight %}

As output, the function returns the <code>residual</code> variable, which has the same dimensions as <code>mixture</code>.

Reference:
Cerutti, S., Baselli, G., Civardi, S., Ferrazzi, E., Marconi, A. M., Pagani, M., & Pardi, G. (1986). Variability analysis of fetal heart rate signals as obtained from abdominal electrocardiographic recordings. Journal of Perinatal Medicine, 14(6), 445â€“452.

 <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> The  <code>FECGSYN_ts_extraction.m</code> function has several pre-built TS methods that can be used by simply substituting <code>'TS-CERUTTI'</code> for <code>'TS'</code>, <code>'TS-SUZANNA'</code>, <code>'TS-LP'</code> or <code>'TS-PCA'</code>. Make sure to see the <a href="{{site.github.url}}/pages/documentation.html#FECGSYN_ts_extraction"><span class="octicon octicon-globe"></span> Documentation</a>. </div></div>

<h2 id="multiext">Multi-method extraction</h2>

Aside from Template Subtraction methods (<code>FECGSYN_ts_extraction.m</code>), the <em>FECGSYN</em> toolbox includes Blind Source Separation (<code>FECGSYN_bss_extraction.m</code>), Kalman Filter (<code>FECGSYN_kf_extraction.m</code>) and Adaptive Filters (<code>FECGSYN_adaptfilt_extraction.m</code>).

Extraction using multiple extraction routines is performed by applying the <code>main_extract_data</code> script, such as:

{% highlight matlab %}
main_extract_data('/FECGSYNDB_PATH/',1,1)
{% endhighlight %}

The function accept directories with both .mat and wfdb formatted data.

 <div class="panel panel-info"><div class="panel-heading"><span class="octicon octicon-info"></span> Tip</div><div class="panel-body"> For batch processing, avoid converting data to WFDB format, since it may cause slow downs. </div></div>


</section>

<!-- ----------- Benchmarking ------- -->
<section class="bs-docs-section">
<h1 id="datext" class="page-header">Benchmarking methods</h1>

<h2 id="fqrs">FQRS detection</h2>
Examplary TS

<h2 id="morpho">Morphological features</h2>
Examplary 
</section>

<!-- -----------GUI------- -->
<section class="bs-docs-section">
<h1 id="guiguide" class="page-header">Using FECGSYN's GUI</h1>

<h2 id="guisub1">How to use it</h2>

TODO. Add some screeshots as a simple guide.



</section>
